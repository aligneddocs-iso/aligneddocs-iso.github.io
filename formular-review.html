<!DOCTYPE html>
<html lang="de">
<head>

  <!-- üîí HARD GUARD: verhindert Flackern & Direktaufruf -->
  <script>
    (function () {
      const raw = sessionStorage.getItem("isoFormData");
      if (!raw || raw === "{}") {
        window.location.replace("de.formular.html");
      }
    })();
  </script>

  <meta charset="utf-8">
  <title>Zusammenfassung ‚Äì ISO 9001 | AlignedDocs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>

<body>
<a class="skip" href="#content">Zum Inhalt springen</a>

<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <div class="brand-mark"><span></span></div>
      <div class="brand-text">
        <strong>AlignedDocs</strong><br>
        <small>ISO 9001:2015 ‚Äì automatisiertes Handbuch</small>
      </div>
    </div>
  </div>
</header>

<main id="content" class="container">

  <section class="hero small">
    <h1>Zusammenfassung Ihrer Angaben</h1>
    <p class="lead">
      Bitte pr√ºfen Sie Ihre Angaben sorgf√§ltig.
      Wenn etwas nicht stimmt, k√∂nnen Sie jederzeit zur√ºckgehen und korrigieren.
    </p>
  </section>

  <section class="form-section" id="summary"></section>

  <div class="actions">
    <a href="de.formular.html" class="btn btn-ghost">Zur√ºck & bearbeiten</a>
    <button class="btn btn-primary" id="confirmBtn">Angaben best√§tigen</button>
  </div>

</main>

<footer class="site-footer">
  <div class="container footer-inner">
    <small>¬© 2026 AlignedDocs</small>
  </div>
</footer>

<script>
/* ================================
   LOAD DATA
================================ */
const data = JSON.parse(sessionStorage.getItem("isoFormData") || "{}");
const summary = document.getElementById("summary");

/* ================================
   LABELS (sauber & professionell)
================================ */
const labels = {
  company_name: "Unternehmensname",
  industry: "Branche / Gesch√§ftst√§tigkeit",
  employees: "Anzahl der Mitarbeitenden",
  region: "Land / Region",

  quality_understanding: "Qualit√§tsverst√§ndnis",
  quality_goals: "Qualit√§tsziele vorhanden",
  quality_goals_description: "Beschreibung der Qualit√§tsziele",

  scope_included: "Geltungsbereich (Scope)",
  scope_exclusions: "Ausgeschlossene T√§tigkeiten",
  scope_exclusions_description: "Beschreibung der Ausschl√ºsse",

  core_process: "Typischer Auftragsablauf",
  critical_steps: "Kritische Prozessschritte",
  external_partners: "Externe Dienstleister / Lieferanten",

  existing_docs: "Vorhandene Dokumentation",
  doc_storage: "Dokumentenablage",

  monitoring: "Prozess√ºberwachung",
  complaints: "Umgang mit Fehlern / Beschwerden",

  email: "E-Mail-Adresse"
};

/* ================================
   EMAIL MASKING
================================ */
function maskEmail(email) {
  if (!email || !email.includes("@")) return "‚Äî";
  const [n, d] = email.split("@");
  return n.charAt(0) + "*****@" + d;
}

/* ================================
   RENDER SUMMARY
================================ */
Object.entries(data).forEach(([key, value]) => {
  if (!value) return;

  let display = value;
  if (key === "email") display = maskEmail(value);

  const block = document.createElement("div");
  block.style.marginBottom = "18px";

  block.innerHTML = `
    <label>${labels[key] || key}</label>
    <div class="review-box">${display}</div>
  `;

  summary.appendChild(block);
});

/* ================================
   CONFIRM (Placeholder)
================================ */
document.getElementById("confirmBtn").addEventListener("click", () => {
  alert("Angaben best√§tigt. Verarbeitung startet im n√§chsten Schritt.");
  // sp√§ter: fetch ‚Üí n8n webhook
});
</script>

</body>
</html>
