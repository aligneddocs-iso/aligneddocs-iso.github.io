<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Zusammenfassung – ISO 9001 | AlignedDocs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Zusammenfassung Ihrer Angaben für das ISO-9001-Handbuch.">
  <link rel="stylesheet" href="style.css">
</head>

<body>
<a class="skip" href="#content">Zum Inhalt springen</a>

<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <div class="brand-mark"><span></span></div>
      <div class="brand-text">
        <strong>AlignedDocs</strong><br>
        <small>ISO 9001:2015 – automatisiertes Handbuch</small>
      </div>
    </div>
  </div>
</header>

<main id="content" class="container">

  <section class="hero small">
    <h1>Zusammenfassung Ihrer Angaben</h1>
    <p class="lead">
      Bitte prüfen Sie Ihre Angaben sorgfältig.
      Die E-Mail-Adresse wird aus Sicherheitsgründen nur teilweise angezeigt.
    </p>
  </section>

  <section id="summary"></section>

  <div class="actions">
    <a href="de.formular.html" class="btn btn-ghost">Zurück & bearbeiten</a>
    <button class="btn btn-primary" id="confirmBtn">
      Angaben bestätigen
    </button>
  </div>

</main>

<footer class="site-footer">
  <div class="container footer-inner">
    <small>© 2026 AlignedDocs</small>
  </div>
</footer>

<script>
/* ==================================================
   FLOW GUARD – REVIEW NUR MIT DATEN
   ================================================== */
const rawData = sessionStorage.getItem("isoFormData");
if (!rawData) {
  window.location.href = "de.formular.html";
}

/* ==================================================
   LOAD DATA (SAFE)
   ================================================== */
const data = JSON.parse(rawData || "{}");
const summary = document.getElementById("summary");

/* ==================================================
   LABEL MAPPING
   ================================================== */
const labels = {
  company_name: "Unternehmensname",
  industry: "Branche / Geschäftstätigkeit",
  employees: "Anzahl der Mitarbeitenden",
  region: "Land / Region der Tätigkeit",

  quality_understanding: "Qualitätsverständnis",
  quality_goals: "Qualitätsziele vorhanden",
  quality_goals_description: "Beschreibung der Qualitätsziele",

  scope_included: "Abgedeckte Tätigkeiten (Scope)",
  scope_exclusions: "Ausgeschlossene Tätigkeiten",
  scope_exclusions_description: "Beschreibung der Ausschlüsse",

  core_process: "Typischer Auftragsablauf",
  critical_steps: "Kritische Schritte",
  external_partners: "Externe Dienstleister / Lieferanten",

  existing_docs: "Vorhandene Dokumentation",
  doc_storage: "Dokumentenablage",

  monitoring: "Überwachung der Prozesse",
  complaints: "Umgang mit Fehlern / Beschwerden",

  email: "E-Mail-Adresse"
};

/* ==================================================
   EMAIL MASKING (ANTI COPY-PASTE)
   ================================================== */
function maskEmail(email) {
  if (!email || !email.includes("@")) return "—";
  const [name, domain] = email.split("@");
  return name.charAt(0) + "*****@" + domain;
}

/* ==================================================
   RENDER SUMMARY (SCREEN-3 STYLE)
   ================================================== */
Object.entries(data).forEach(([key, value]) => {
  if (!value || !labels[key]) return;

  let displayValue = value;
  if (key === "email") displayValue = maskEmail(value);

  const block = document.createElement("section");
  block.className = "form-section";

  block.innerHTML = `
    <label>${labels[key]}</label>
    <div class="review-box">${displayValue}</div>
  `;

  summary.appendChild(block);
});

/* ==================================================
   CONFIRM (READY FOR n8n)
   ================================================== */
document.getElementById("confirmBtn").addEventListener("click", () => {
  alert("Angaben bestätigt. Die Verarbeitung startet im nächsten Schritt.");
  // TODO: fetch() → n8n Webhook
});
</script>

</body>
</html>
